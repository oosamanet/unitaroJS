<html>
<head>
<meta charset="utf-8">
<title>UNITAROjs</title>
<meta name="viewport" content="width=device-width,user-scalable=no" />
<style>
body{
  margin: 0px;
  padding: 0px;
}
#canvas-area{
float:left;
margin-right: 10px;
}
#code-area{
}
.code-template{
 display:none;
}
</style>
<script src="js/unitaro.js"></script>
</head>
<body>
<div class="code-template">
<div id="A" class="code">{ /* STEP1 - Taskを移動してみる */
 x:160,
 y:300,
 w:20,
 h:20,
 color:'red',
 init:function(){
 },
 update:function(age){
/*
 ここに書いた処理は１秒に２０回実行されます

ヒント:

右に移動する -> this.x=this.x+1
下に移動する -> this.y=this.y+1;
*/
  //＊＊ここに書く＊＊
  
 },
}
</div>
<div id="B" class="code">{
 x:100,
 y:100,
 w:20,
 h:20,
 init:function(){
 },
 update:function(age){
  this.x++;
 },
}
</div>
<div id="C" class="code">{
 x:100,
 y:100,
 w:20,
 h:20,
 init:function(){
 },
 update:function(age){
  this.x++;
 },
}
</div>
</div>
<script>
function load(){
  var list=document.getElementsByClassName('code');
  
  var elm=document.getElementById('template');
  var tmp=list[elm.value].innerText;
  if (tmp!=""){
    var out=document.getElementById('code');
    out.value=tmp;
  }
}

function go(){
  var elm=document.getElementById('code');
  var obj=new Function('return ' + elm.value)();
console.dir(obj);
  var task=new unitaro.Task(obj,0,0);
  task.set_type('player');
}

var GameScene={
  init:function(){
    new unitaro.Task(BASE,-50,app.HEIGHT/2,100,app.HEIGHT,'orange');
    new unitaro.Task(BASE,app.WIDTH+50,app.HEIGHT/2,100,app.HEIGHT,'orange');
    new unitaro.Task(BASE,app.WIDTH/2,-50,app.WIDTH,100,'orange');
    new unitaro.Task(BASE,app.WIDTH/2,app.HEIGHT+50,app.WIDTH,100,'orange');

    console.dir("GameScene");
    var self=this;
    var walls=[
     function(){
      self.wall=new unitaro.Task(BASE,app.WIDTH/2,100,80,40,'yellow');
     },
     function(){
      self.wall=new unitaro.Task(BASE,app.WIDTH/2,400,80,40,'yellow');
     },
     function(){
      self.wall=new unitaro.Task(BASE,app.WIDTH/4+20,200,200,40,'orange');
      self.wall=new unitaro.Task(BASE,app.WIDTH*3/4,100,80,40,'yellow');
     },
    ];
    (walls[app.stage])();
  },
  draw:function(){
  },
  update:function(){
    unitaro.TaskManager.hitcheck_all("player","wall");
    if (!this.wall.live){
        app.stageclear();
	    unitaro.TaskManager.clear();
	    new unitaro.Task(ResultScene);
	}
  },
  onclick:function(){
    app.score++;
  }
};

var ResultScene={
  init:function(){
  },
  update:function(){
    unitaro.dib.textout(150,220,"Stage "+app.stage+" clear","white",100);
    unitaro.dib.textout(150,270,"Score: "+app.score,100);
    unitaro.dib.textout(150,370,"Click to Continue","white",100);
  },
  onclick:function(){
    console.dir("hoge");
    unitaro.TaskManager.clear();
    new unitaro.Task(GameScene);
  }
};

var BASE = {
  w:80,
  h:50,
  color:'yellow',
  init:function(x,y,w,h,color){
    this.x=x;
    this.y=y;
    this.w=w;
    this.h=h;
    this.color=color;
    this.set_type('wall');
  },
  update:function(age){
  },
};

var APP = {
  WIDTH: 320,
  HEIGHT: 500,
  stage:0,
  target:'canvas-area',
  init: function(){
    this.stagestart();
    new unitaro.Task(GameScene,app.WIDTH/2,app.HEIGHT*3/4);
  },
  stagestart:function(){
    this.stage=0;
    this.score=0;
  },
  stageclear:function(){
    this.stage++;
  },
  update: function(age){
    unitaro.dib.box(0,0,this.WIDTH,this.HEIGHT,"rgb(0,0,0)");
    unitaro.dib.textout(50,20,"CODING GAME","white",100);

    unitaro.TaskManager.hitcheck_all('box','kabe');
  },
  onclick: function(x,y){
  }
};

window.addEventListener('load',function(){
	window.app = new unitaro.App(APP);
    load();
},false);

</script>
<div id="canvas-area"></div>
<div id="code-area">
CODE:<br />
<select id="template">
<option value="0">STEP1 - 移動
<option value="1">サンプルB
<option value="2">サンプルC
</select>
<button onclick="load()">サンプルをロード</button><br />
<textarea id="code" cols="60" rows="30"></textarea><br />
<button onclick="go()">GO</button>
</div>
</body>
</html>
